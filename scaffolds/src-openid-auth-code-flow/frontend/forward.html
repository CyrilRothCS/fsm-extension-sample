<script src="https://fsmsapxf.accounts400.ondemand.com/ui/resources/javascripts/jquery.min.js"></script>
<script src="https://unpkg.com/fsm-shell"></script>
<script>

  const { ShellSdk, SHELL_EVENTS } = FSMShell;
  // Init ShellSDk
  const shellSdk = ShellSdk.init(window.parent, '*');

  if (!ShellSdk.isInsideShell()) {
    $('#noShell').css('display', 'block');
  } else {
    shellSdk.on(SHELL_EVENTS.Version1.REQUIRE_CONTEXT, (event) => {
      console.log(JSON.parse(event));

      const {
        cloudHost,
        account,
        companyId,
        userId
      } = JSON.parse(event);

      $.ajax
      ({
        type: "GET",
        url: '/auth/provider/callback' + window.location.search,
        dataType: 'json',
        headers: {
          "cloudHost": cloudHost,
          "account": account,
          "companyId": companyId,
          "userId": userId,
        },
        success: function (data){
          if (data.token) {
            sessionStorage.setItem('token', data.token);
            window.location.href = '/';
          }
        },
        error: function (xhr, status, error) {
          if (xhr.responseJSON && xhr.responseJSON.message) {
            alert(xhr.responseJSON.message);
          }
          window.location.href = '/';
        }
      });
    });
    
    shellSdk.emit(SHELL_EVENTS.Version1.REQUIRE_CONTEXT, {
      clientIdentifier: 'example-plugin',
    });
  }

</script>
<div id="noShell" style="display: none;">
  <p>Extension need to run inside Shell</p>
</div>